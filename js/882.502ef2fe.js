"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[882],{7588:function(e,n,s){var t=s(6518),r=s(9565),a=s(2652),c=s(9306),i=s(8551),o=s(1767),h=s(9539),d=s(4549),l=d("forEach",TypeError);t({target:"Iterator",proto:!0,real:!0,forced:l},{forEach:function(e){i(this);try{c(e)}catch(t){h(this,"throw",t)}if(l)return r(l,this,e);var n=o(this),s=0;a(n,function(n){e(n,s++)},{IS_RECORD:!0})}})},9989:function(e,n,s){s.r(n),s.d(n,{default:function(){return y}});var t=s(3847),r=s(89),a=s(1253),c=s(793),i=function(){var e=this,n=e._self._c;return n(c.A,[n(r.A,[n(a.ri,[e._v("Scanner QR Code")]),n(a.OQ,[e.isScanning?n("qr-code-scanner",{on:{"scan-success":e.handleScanSuccess,"scan-error":e.handleScanError}}):n(t.A,{attrs:{color:"primary"},on:{click:e.startScanner}},[e._v(" Démarrer le scan ")])],1)],1)],1)},o=[],h=function(){var e=this,n=e._self._c;return n("div",{staticClass:"qr-scanner"},[n("video",{ref:"video",attrs:{width:"100%",autoplay:"",playsinline:""}}),n("canvas",{ref:"canvas",staticStyle:{display:"none"}})])},d=[],l=(s(8111),s(7588),{name:"QrCodeScanner",emits:["scan-success","scan-error"],data:()=>({scanner:null}),mounted(){this.initScanner()},beforeUnmount(){this.stopScanner()},methods:{async initScanner(){try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});this.$refs.video.srcObject=e,this.scanner=setInterval(this.scanQrCode,500)}catch(e){this.$emit("scan-error",e)}},scanQrCode(){const e=this.$refs.video,n=this.$refs.canvas,s=n.getContext("2d");n.width=e.videoWidth,n.height=e.videoHeight,s.drawImage(e,0,0,n.width,n.height);try{const e=this.decodeQrFromCanvas(n);e&&(this.$emit("scan-success",e),this.stopScanner())}catch(t){this.$emit("scan-error",t)}},stopScanner(){this.scanner&&(clearInterval(this.scanner),this.scanner=null),this.$refs.video.srcObject&&this.$refs.video.srcObject.getTracks().forEach(e=>e.stop())}}}),u=l,f=s(1656),v=(0,f.A)(u,h,d,!1,null,null,null),S=v.exports,p={name:"ScanView",components:{QrCodeScanner:S},data:()=>({isScanning:!1}),methods:{startScanner(){this.isScanning=!0},async handleScanSuccess(e){try{await this.$api.post("/attendance/scan",{token:e,studentId:this.$store.getters["auth/currentUser"].id}),this.$store.dispatch("showSnackbar",{message:"Présence enregistrée!",color:"success"})}catch(n){this.handleScanError(n)}finally{this.isScanning=!1}},handleScanError(e){this.$store.dispatch("showSnackbar",{message:e.response?.data?.message||"Erreur de scan",color:"error"})}}},m=p,g=(0,f.A)(m,i,o,!1,null,null,null),y=g.exports}}]);
//# sourceMappingURL=882.502ef2fe.js.map