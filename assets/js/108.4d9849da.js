"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[108],{1526:function(e,t,s){s(4114),s(8111),s(7588),s(3579),s(125);var r=s(5471),n=s(4961),o=s(6960);const i=["sm","md","lg","xl"],a=(()=>i.reduce((e,t)=>(e[t]={type:[Boolean,String,Number],default:!1},e),{}))(),l=(()=>i.reduce((e,t)=>(e["offset"+(0,o.Zb)(t)]={type:[String,Number],default:null},e),{}))(),c=(()=>i.reduce((e,t)=>(e["order"+(0,o.Zb)(t)]={type:[String,Number],default:null},e),{}))(),d={col:Object.keys(a),offset:Object.keys(l),order:Object.keys(c)};function u(e,t,s){let r=e;if(null!=s&&!1!==s){if(t){const s=t.replace(e,"");r+=`-${s}`}return"col"!==e||""!==s&&!0!==s?(r+=`-${s}`,r.toLowerCase()):r.toLowerCase()}}const h=new Map;t.A=r.Ay.extend({name:"v-col",functional:!0,props:{cols:{type:[Boolean,String,Number],default:!1},...a,offset:{type:[String,Number],default:null},...l,order:{type:[String,Number],default:null},...c,alignSelf:{type:String,default:null,validator:e=>["auto","start","end","center","baseline","stretch"].includes(e)},tag:{type:String,default:"div"}},render(e,{props:t,data:s,children:r,parent:o}){let i="";for(const n in t)i+=String(t[n]);let a=h.get(i);if(!a){let e;for(e in a=[],d)d[e].forEach(s=>{const r=t[s],n=u(e,s,r);n&&a.push(n)});const s=a.some(e=>e.startsWith("col-"));a.push({col:!s||!t.cols,[`col-${t.cols}`]:t.cols,[`offset-${t.offset}`]:t.offset,[`order-${t.order}`]:t.order,[`align-self-${t.alignSelf}`]:t.alignSelf}),h.set(i,a)}return e(t.tag,(0,n.Ay)(s,{class:a}),r)}})},1770:function(e,t,s){s.d(t,{A:function(){return n}});var r=s(3661),n=r.A.extend({name:"v-divider",props:{inset:Boolean,vertical:Boolean},render(e){let t;return this.$attrs.role&&"separator"!==this.$attrs.role||(t=this.vertical?"vertical":"horizontal"),e("hr",{class:{"v-divider":!0,"v-divider--inset":this.inset,"v-divider--vertical":this.vertical,...this.themeClasses},attrs:{role:"separator","aria-orientation":t,...this.$attrs},on:this.$listeners})}})},2781:function(e,t,s){s.d(t,{A:function(){return h}});var r=s(7495),n=s(3536),o=s(7889),i=s(9748),a=s(3661),l=s(5471),c=l.Ay.extend({name:"transitionable",props:{mode:String,origin:String,transition:String}}),d=s(3507),u=s(5604),h=(0,d.A)(r.A,i.A,c).extend({name:"v-alert",props:{border:{type:String,validator(e){return["top","right","bottom","left"].includes(e)}},closeLabel:{type:String,default:"$vuetify.close"},coloredBorder:Boolean,dense:Boolean,dismissible:Boolean,closeIcon:{type:String,default:"$cancel"},icon:{default:"",type:[Boolean,String],validator(e){return"string"===typeof e||!1===e}},outlined:Boolean,prominent:Boolean,text:Boolean,type:{type:String,validator(e){return["info","error","success","warning"].includes(e)}},value:{type:Boolean,default:!0}},computed:{__cachedBorder(){if(!this.border)return null;let e={staticClass:"v-alert__border",class:{[`v-alert__border--${this.border}`]:!0}};return this.coloredBorder&&(e=this.setBackgroundColor(this.computedColor,e),e.class["v-alert__border--has-color"]=!0),this.$createElement("div",e)},__cachedDismissible(){if(!this.dismissible)return null;const e=this.iconColor;return this.$createElement(n.A,{staticClass:"v-alert__dismissible",props:{color:e,icon:!0,small:!0},attrs:{"aria-label":this.$vuetify.lang.t(this.closeLabel)},on:{click:()=>this.isActive=!1}},[this.$createElement(o.A,{props:{color:e}},this.closeIcon)])},__cachedIcon(){return this.computedIcon?this.$createElement(o.A,{staticClass:"v-alert__icon",props:{color:this.iconColor}},this.computedIcon):null},classes(){const e={...r.A.options.computed.classes.call(this),"v-alert--border":Boolean(this.border),"v-alert--dense":this.dense,"v-alert--outlined":this.outlined,"v-alert--prominent":this.prominent,"v-alert--text":this.text};return this.border&&(e[`v-alert--border-${this.border}`]=!0),e},computedColor(){return this.color||this.type},computedIcon(){return!1!==this.icon&&("string"===typeof this.icon&&this.icon?this.icon:!!["error","info","success","warning"].includes(this.type)&&`$${this.type}`)},hasColoredIcon(){return this.hasText||Boolean(this.border)&&this.coloredBorder},hasText(){return this.text||this.outlined},iconColor(){return this.hasColoredIcon?this.computedColor:void 0},isDark(){return!(!this.type||this.coloredBorder||this.outlined)||a.A.options.computed.isDark.call(this)}},created(){this.$attrs.hasOwnProperty("outline")&&(0,u.q4)("outline","outlined",this)},methods:{genWrapper(){const e=[this.$slots.prepend||this.__cachedIcon,this.genContent(),this.__cachedBorder,this.$slots.append,this.$scopedSlots.close?this.$scopedSlots.close({toggle:this.toggle}):this.__cachedDismissible],t={staticClass:"v-alert__wrapper"};return this.$createElement("div",t,e)},genContent(){return this.$createElement("div",{staticClass:"v-alert__content"},this.$slots.default)},genAlert(){let e={staticClass:"v-alert",attrs:{role:"alert"},on:this.listeners$,class:this.classes,style:this.styles,directives:[{name:"show",value:this.isActive}]};if(!this.coloredBorder){const t=this.hasText?this.setTextColor:this.setBackgroundColor;e=t(this.computedColor,e)}return this.$createElement("div",e,[this.genWrapper()])},toggle(){this.isActive=!this.isActive}},render(e){const t=this.genAlert();return this.transition?e("transition",{props:{name:this.transition,origin:this.origin,mode:this.mode}},[t]):t}})},3123:function(e,t,s){s.r(t),s.d(t,{default:function(){return M}});var r=s(2781),n=s(375),o=s(7210),i=s(8834),a=s(1526),l=s(6278),c=s(1770),d=s(9456),u=s(2987),h=s(1075),p=s(380),g=s(2585),f=s(8412),m=function(){var e=this,t=e._self._c;return t(l.A,{attrs:{fluid:""}},[t(f.A,[t(a.A,{attrs:{cols:"12",md:"4"}},[t(o.A,{attrs:{outlined:""}},[t(i.ri,[e._v("Mes séances")]),t(c.A),t(u.A,{attrs:{"two-line":""}},[e._l(e.sessions,function(s){return t(h.A,{key:s.id,class:{"grey lighten-4":e.selectedSession?.id===s.id},on:{click:function(t){return e.selectSession(s)}}},[t(p.pr,[t(p.UZ,[e._v(e._s(s.subject))]),t(p.w,[e._v(" "+e._s(e.formatDate(s.startTime))+" • Groupe: "+e._s(s.group.name)+" ")])],1)],1)}),e.sessions.length?e._e():t(h.A,[t(p.pr,[e.loadingSessions?t(g.A,{attrs:{indeterminate:"",color:"primary"}}):t("span",[e._v("Aucune séance trouvée")])],1)],1)],2)],1)],1),t(a.A,{attrs:{cols:"12",md:"8"}},[e.selectedSession?t("div",[t(o.A,{staticClass:"mb-4",attrs:{outlined:""}},[t(i.ri,[e._v("Détails de la séance")]),t(i.OQ,[t("session-info",{attrs:{session:e.selectedSession}}),t("div",{staticClass:"mt-2 text-caption"},[e._v(" Enseignant: "+e._s(e.selectedSession.teacher.firstname)+" "+e._s(e.selectedSession.teacher.lastname)+" ")])],1)],1),t(o.A,{staticClass:"mb-4",attrs:{outlined:""}},[t(i.ri,[e._v("QR Code de présence")]),t(i.OQ,[t("qr-code-generator",{attrs:{sessionId:e.selectedSession.id},on:{"qr-generated":e.handleQrGenerated}})],1)],1),t(n.A,{staticClass:"mb-4",attrs:{color:"primary",loading:e.pdfLoading},on:{click:e.downloadPdf}},[t(d.A,{attrs:{left:""}},[e._v("mdi-file-pdf-box")]),e._v(" Télécharger fiche ")],1),t("attendance-list",{attrs:{attendances:e.attendances,loading:e.loadingAttendances},on:{refresh:e.refreshAttendances}})],1):t("div",[t(r.A,{attrs:{type:"info",outlined:""}},[e._v("Sélectionnez une séance")])],1)])],1)],1)},v=[],_=(s(4114),s(7891)),y=function(){var e=this,t=e._self._c;return t(o.A,{attrs:{outlined:""}},[t(i.ri,[e._v("Présences")]),t(i.OQ,[t(_.A,[t("thead",[t("tr",[t("th",[e._v("N°")]),t("th",[e._v("Étudiant")]),t("th",[e._v("Email")]),t("th",[e._v("Validé par")]),t("th",[e._v("Manuel")])])]),t("tbody",e._l(e.attendances,function(s,r){return t("tr",{key:s.id},[t("td",[e._v(e._s(r+1))]),t("td",[e._v(e._s(s.student.lastname)+" "+e._s(s.student.firstname))]),t("td",[e._v(e._s(s.student.email))]),t("td",[e._v(e._s(s.validator?.lastname||"-"))]),t("td",[t(n.A,{attrs:{icon:"",small:""},on:{click:function(t){return e.markPresent(s)}}},[t(d.A,{attrs:{color:"green"}},[e._v("mdi-check")])],1)],1)])}),0)]),t(n.A,{attrs:{text:"",small:""},on:{click:function(t){return e.$emit("refresh")}}},[e._v("Rafraîchir")])],1)],1)},A=[],b=s(4300),S={props:{attendances:Array,loading:Boolean},methods:{async markPresent(e){try{await b.A.put(`/api/attendances/${e.id}`,{status:"present"}),this.$emit("refresh")}catch(t){console.error(t)}}}},$=S,C=s(1656),w=(0,C.A)($,y,A,!1,null,null,null),E=w.exports,x=function(){var e=this,t=e._self._c;return t("div",{staticClass:"text-center"},[t(n.A,{attrs:{color:"primary",loading:e.loading,disabled:e.loading},on:{click:e.generateQrCode}},[t(d.A,{attrs:{left:""}},[e._v("mdi-qrcode")]),e._v(" Générer le QR Code ")],1),t("div",{staticClass:"mt-4"},[e.qr?t("div",[t("p",{staticClass:"text-green"},[e._v("QR généré :")]),t("img",{staticStyle:{"max-width":"200px","margin-top":"10px"},attrs:{src:e.qr,alt:"QR Code"}}),t("div",{staticClass:"caption grey--text"},[e._v("Valable 5 minutes")])]):t("p",{staticClass:"text-red"},[e._v("Aucun QR généré")])])],1)},B=[],k={name:"QrCodeGenerator",props:{sessionId:{type:Number,required:!0}},data(){return{qr:"",loading:!1}},methods:{async generateQrCode(){this.loading=!0;try{const e=localStorage.getItem("token"),t=await b.A.post("/api/qrcode/generate",{sessionId:this.sessionId},{headers:{Authorization:`Bearer ${e}`}});console.log("QR reçu du backend :",t.data.qrCode),this.qr=t.data.qrCodeUrl,this.$emit("qr-generated",this.qr)}catch(e){console.error("Erreur génération QR:",e),this.$emit("error",e)}finally{this.loading=!1}}}},I=k,j=(0,C.A)(I,x,B,!1,null,"45acaaeb",null),q=j.exports,Q=function(){var e=this,t=e._self._c;return t("div",[t("p",[t("strong",[e._v("Sujet :")]),e._v(" "+e._s(e.session.subject))]),t("p",[t("strong",[e._v("Salle :")]),e._v(" "+e._s(e.session.room))]),e.session.group?t("p",[t("strong",[e._v("Groupe :")]),e._v(" "+e._s(e.session.group.name)+" ")]):t("p",[t("strong",[e._v("Groupe :")]),e._v(" — ")]),t("p",[t("strong",[e._v("Horaire :")]),e._v(" "+e._s(e.formatDate(e.session.startTime))+" – "+e._s(e.formatDate(e.session.endTime))+" ")]),e.session.teacher?t("p",[t("strong",[e._v("Enseignant :")]),e._v(" "+e._s(e.session.teacher.firstname)+" "+e._s(e.session.teacher.lastname)+" ")]):t("p",[t("strong",[e._v("Enseignant :")]),e._v(" — ")])])},D=[],R=s(1152),L={name:"SessionInfo",props:{session:{type:Object,required:!0}},methods:{formatDate(e){return(0,R.GP)(new Date(e),"dd/MM/yyyy HH:mm")}}},O=L,G=(0,C.A)(O,Q,D,!1,null,"78aad8f6",null),T=G.exports,P={name:"SessionView",components:{SessionInfo:T,QrCodeGenerator:q,AttendanceList:E},data(){return{sessions:[],selectedSession:null,attendances:[],pdfLoading:!1,loadingSessions:!1,loadingAttendances:!1,qrData:null}},async created(){await this.loadSessions()},methods:{formatDate(e){return(0,R.GP)(new Date(e),"dd/MM/yyyy HH:mm")},async loadSessions(){this.loadingSessions=!0;try{const e=localStorage.getItem("token");if(!e)throw new Error("Authentification requise");const t=await b.A.get("/api/sessions/teacher",{headers:{Authorization:`Bearer ${e}`}});this.sessions=t.data||[]}catch(e){console.error("Erreur chargement sessions:",{message:e.message,response:e.response?.data}),this.showError(e.response?.data?.message||"Erreur lors du chargement des sessions"),401===e.response?.status&&this.$router.push("/login")}finally{this.loadingSessions=!1}},async selectSession(e){this.selectedSession=e,await this.refreshAttendances()},async refreshAttendances(){if(this.selectedSession){this.loadingAttendances=!0;try{const e=localStorage.getItem("token");if(!e)throw new Error("Authentification requise");const t=await b.A.get(`/api/attendances/session/${this.selectedSession.id}`,{headers:{Authorization:`Bearer ${e}`}});this.attendances=t.data||[]}catch(e){console.error("Erreur chargement présences:",{message:e.message,status:e.response?.status}),this.showError(e.response?.data?.message||"Erreur lors du chargement des présences"),401===e.response?.status&&this.$router.push("/login")}finally{this.loadingAttendances=!1}}},async downloadPdf(e=!1){if(this.selectedSession){this.pdfLoading=!0;try{const t=localStorage.getItem("token");if(!t)throw new Error("Authentification requise");let s,r;if(e){const e=new Date(this.selectedSession.startTime).toISOString().split("T")[0];s=`/api/pdf/generate-daily/${e}/${this.selectedSession.groupId}`,r=`emargement_groupe_${this.selectedSession.groupId}_${e}.pdf`}else s=`/api/pdf/generate/${this.selectedSession.id}`,r=`emargement_${this.selectedSession.subject}_${this.selectedSession.id}.pdf`;const n=await b.A.get(s,{responseType:"blob",headers:{Authorization:`Bearer ${t}`,"Cache-Control":"no-cache"}}),o=window.URL.createObjectURL(new Blob([n.data])),i=document.createElement("a");i.href=o,i.setAttribute("download",r),document.body.appendChild(i),i.click(),setTimeout(()=>{window.URL.revokeObjectURL(o),document.body.removeChild(i)},100),this.showSuccess("Fiche d'émargement générée avec succès")}catch(t){console.error("Erreur téléchargement PDF:",{message:t.message,status:t.response?.status}),this.showError(t.response?.data?.message||"Erreur lors de la génération du PDF"),401===t.response?.status&&this.$router.push("/login")}finally{this.pdfLoading=!1}}},handleQrGenerated(e){this.qrData=e,this.showSuccess("QR Code généré avec succès"),this.refreshAttendances()},handleQrError(e){console.error("Erreur du composant QR:",e),this.showError(e.message||"Erreur avec le QR Code")},showError(e){try{this.$toast?.error?this.$toast.error(e,{position:"top-right",timeout:3e3}):console.error("Erreur:",e)}catch(t){console.error("Erreur dans showError:",t)}},showSuccess(e){try{this.$toast?.success&&this.$toast.success(e,{position:"top-right",timeout:2e3})}catch(t){console.error("Erreur dans showSuccess:",t)}}}},N=P,H=(0,C.A)(N,m,v,!1,null,"30a38f5a",null),M=H.exports},7889:function(e,t,s){var r=s(9456);t.A=r.A},7891:function(e,t,s){s.d(t,{A:function(){return i}});var r=s(6960),n=s(3661),o=s(3507),i=(0,o.A)(n.A).extend({name:"v-simple-table",props:{dense:Boolean,fixedHeader:Boolean,height:[Number,String]},computed:{classes(){return{"v-data-table--dense":this.dense,"v-data-table--fixed-height":!!this.height&&!this.fixedHeader,"v-data-table--fixed-header":this.fixedHeader,"v-data-table--has-top":!!this.$slots.top,"v-data-table--has-bottom":!!this.$slots.bottom,...this.themeClasses}}},methods:{genWrapper(){return this.$slots.wrapper||this.$createElement("div",{staticClass:"v-data-table__wrapper",style:{height:(0,r.Dg)(this.height)}},[this.$createElement("table",this.$slots.default)])}},render(e){return e("div",{staticClass:"v-data-table",class:this.classes},[this.$slots.top,this.genWrapper(),this.$slots.bottom])}})},8412:function(e,t,s){s(4114),s(8111),s(7588),s(125);var r=s(5471),n=s(4961),o=s(6960);const i=["sm","md","lg","xl"],a=["start","end","center"];function l(e,t){return i.reduce((s,r)=>(s[e+(0,o.Zb)(r)]=t(),s),{})}const c=e=>[...a,"baseline","stretch"].includes(e),d=l("align",()=>({type:String,default:null,validator:c})),u=e=>[...a,"space-between","space-around"].includes(e),h=l("justify",()=>({type:String,default:null,validator:u})),p=e=>[...a,"space-between","space-around","stretch"].includes(e),g=l("alignContent",()=>({type:String,default:null,validator:p})),f={align:Object.keys(d),justify:Object.keys(h),alignContent:Object.keys(g)},m={align:"align",justify:"justify",alignContent:"align-content"};function v(e,t,s){let r=m[e];if(null!=s){if(t){const s=t.replace(e,"");r+=`-${s}`}return r+=`-${s}`,r.toLowerCase()}}const _=new Map;t.A=r.Ay.extend({name:"v-row",functional:!0,props:{tag:{type:String,default:"div"},dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:c},...d,justify:{type:String,default:null,validator:u},...h,alignContent:{type:String,default:null,validator:p},...g},render(e,{props:t,data:s,children:r}){let o="";for(const n in t)o+=String(t[n]);let i=_.get(o);if(!i){let e;for(e in i=[],f)f[e].forEach(s=>{const r=t[s],n=v(e,s,r);n&&i.push(n)});i.push({"no-gutters":t.noGutters,"row--dense":t.dense,[`align-${t.align}`]:t.align,[`justify-${t.justify}`]:t.justify,[`align-content-${t.alignContent}`]:t.alignContent}),_.set(o,i)}return e(t.tag,(0,n.Ay)(s,{staticClass:"row",class:i}),r)}})}}]);
//# sourceMappingURL=108.4d9849da.js.map